# NovaChart

LoLのレート推移を可視化・分析するWebアプリケーション

## 機能

- **レート推移の可視化**: 折れ線グラフでレート推移を表示
- **目標設定**: 目標ランク・LP・日付を設定
- **到達予測**: 線形回帰と移動平均による予測
- **進捗率計算**: 目標までの達成度を表示
- **必要試合数算出**: 勝率とプレイ頻度から必要試合数を計算
- **統計情報**: 勝率、総試合数、LP変動などの統計を表示
- **Riot API連携**: サマナー情報とランク情報を自動取得

## セットアップ

1. 依存関係のインストール
```bash
cd NovaChart
npm install
```

2. 環境変数の設定

`.env.local`ファイルを作成し、必要に応じてRiot Games APIキーを設定してください。

```bash
# .env.local
RIOT_API_KEY=your_api_key_here
RIOT_API_REGION=jp1
```

**注意**: 
- `RIOT_API_KEY`: レート情報の取得には必要です。サマナー情報の取得は、データベースに既存の情報があればAPIキーなしでも可能です。
- `RIOT_API_REGION`: オプション（デフォルト: `jp1`）。使用可能な値: `jp1`, `kr`, `na1`, `euw1`, `eun1` など
- **重要**: `.env.local`ファイルを変更した場合は、開発サーバーを再起動してください（環境変数の変更を反映するため）

Riot Games APIキーは [Riot Developer Portal](https://developer.riotgames.com/) で取得できます。

`.env.local.example`ファイルを参考にしてください。

3. 開発サーバーの起動
```bash
npm run dev
```

ブラウザで [http://localhost:3000](http://localhost:3000) を開いてください。

## 使い方

### サマナー検索

以下の3つの方法でサマナーを検索できます：

1. **サマナー名で検索**: サマナー名とリージョンを入力（APIキー必要）
2. **サマナーIDで検索**: サマナーIDを入力（データベースにあればAPIキー不要）
3. **PUUIDで検索**: PUUIDを入力（データベースにあればAPIキー不要）

一度検索したサマナー情報はデータベースに保存されるため、次回からはAPIキーなしでもサマナー情報を取得できます。

#### サマナー名の入力形式

- **文字数**: 3文字以上、16文字以下
- **使用可能な文字**: 
  - 英数字（A-Z、a-z、0-9）
  - スペース
  - ピリオド（`.`）
  - アンダースコア（`_`）
  - ハイフン（`-`）
- **注意事項**:
  - タグ（`#XXXX`）は含めないでください（サマナー名のみ）
  - 大文字小文字は区別されません
  - スペースを含む場合はそのまま入力してください（例: `Player Name`）

**例**: `PlayerName`, `Player Name`, `Player_Name`, `Player-Name`

### 基本的な使い方

1. **サマナー検索**: 上記のいずれかの方法でサマナーを検索
2. **レート更新**: 「レート更新」ボタンで現在のランク・LPを取得して保存（APIキー必要）
3. **目標設定**: 目標のティア・ランク・LP・日付を設定
4. **データ確認**: グラフと統計パネルで進捗を確認

## 技術スタック

- **フレームワーク**: Next.js 14 (App Router)
- **言語**: TypeScript
- **スタイリング**: Tailwind CSS
- **データ保存**: IndexedDB (Dexie.js)
- **グラフ**: Recharts
- **状態管理**: Zustand
- **API**: Riot Games API

## データ保存

データはブラウザのIndexedDBに保存されます。ブラウザのデータをクリアすると、保存されたデータも削除されます。

将来的にはVercelやAWS S3への移行を検討しています。

## トラブルシューティング

### 403 Forbidden エラーが発生する場合

1. **APIキーの確認**
   - `.env.local`ファイルに`RIOT_API_KEY`が正しく設定されているか確認してください
   - APIキーに余分なスペースや改行が含まれていないか確認してください
   - **開発サーバーを再起動してください**（環境変数の変更を反映するため）
     ```bash
     # 開発サーバーを停止（Ctrl+C）してから再起動
     npm run dev
     ```

### APIキーが設定されていないエラーが発生する場合

1. **`.env.local`ファイルの確認**
   - `NovaChart`ディレクトリに`.env.local`ファイルが存在するか確認してください
   - ファイルの内容が正しいか確認してください：
     ```bash
     cat .env.local
     ```

2. **開発サーバーの再起動**
   - `.env.local`ファイルを変更した場合は、必ず開発サーバーを再起動してください
   - Next.jsは起動時に環境変数を読み込むため、実行中の変更は反映されません
   ```bash
   # 開発サーバーを停止（Ctrl+C）してから再起動
   npm run dev
   ```

3. **APIキーの形式確認**
   - APIキーは`RGAPI-`で始まる文字列です
   - 例: `RGAPI-xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx`
   - 余分なスペースや引用符が含まれていないか確認してください

2. **APIキーの有効性**
   - [Riot Developer Portal](https://developer.riotgames.com/)でAPIキーが有効か確認してください
   - 開発用APIキーは24時間で期限切れになります。期限切れの場合は新しいキーを取得してください
   - 本番用APIキーを使用している場合、適切な権限が設定されているか確認してください

3. **APIキーの形式**
   - APIキーは`RGAPI-`で始まる文字列です
   - 例: `RGAPI-xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx`

### その他のエラー

- **401 Unauthorized**: APIキーが設定されていません。`.env.local`ファイルを確認してください
- **404 Not Found**: サマナー名、リージョン、またはサマナーID/PUUIDが正しくありません
- **429 Too Many Requests**: APIレート制限に達しました。しばらく待ってから再試行してください

## 注意事項

- **APIキーについて**: 
  - レート情報の取得にはAPIキーが必要です
  - サマナー情報の取得は、データベースに既存の情報があればAPIキーなしでも可能です
  - Riot Games APIにはレート制限があります。開発用キーは制限が厳しいため、本番環境では適切なキーを使用してください
  - 開発用APIキーは24時間で期限切れになります

- **データ保存**: 
  - データはブラウザのIndexedDBに保存されます
  - ブラウザを変更したりデータをクリアすると失われます
  - 一度検索したサマナー情報は保存されるため、次回からはAPIキーなしでもサマナー情報を取得できます

- **サマナーID/PUUIDの取得方法**: 
  - サマナーIDやPUUIDは、一度サマナー名で検索すると表示されます
  - または、Riot Games APIや他のツールから取得できます

